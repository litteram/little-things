{"version":3,"file":"module.js","sources":["node_modules/rambda/src/keys.js","src/constants.js","src/log.js","src/settings.js","src/reroll_health.js","src/index.js"],"sourcesContent":["export function keys(x){\n  return Object.keys(x)\n}\n","import * as mod from \"../module.json\"\n\nexport const moduleName = mod.id\nexport const i18n = (key) => game.i18n.localize(key)\n","import { moduleName } from \"./constants.js\"\n\nexport const log = (function () {\n  var context = moduleName + \" | \"\n  return Function.prototype.bind.call(console.log, console, context)\n})()\n\nexport const warn = (function () {\n  var context = moduleName + \" | \"\n  return Function.prototype.bind.call(console.warn, console, context)\n})()\n\nexport const err = (function () {\n  var context = moduleName + \" | \"\n  return Function.prototype.bind.call(console.error, console, context)\n})()\n","import { map, keys } from \"rambda\"\nimport { moduleName, i18n } from \"./constants.js\"\nimport { log } from \"./log.js\"\n\nconst settings = {\n  \"reroll-npc-health\": {\n    kind: Boolean,\n    default: true,\n  },\n}\n\nlet memo = {}\nexport function getSettings() {\n  if (!memo._) {\n    for (const key of keys(settings)) {\n      memo[key] = window.game.settings.settings.get(\n        `${moduleName}.${key}`,\n      )?.config\n    }\n    memo._ = 1\n  }\n  return memo\n}\n\nexport function registerSettings() {\n  for (const key of keys(settings)) {\n    log(\"registering:\", key)\n    window.game.settings.register(moduleName, key, {\n      name: i18n(`${moduleName}.${key}.name`),\n      hint: i18n(`${moduleName}.${key}.hint`),\n      scope: \"world\",\n      config: true,\n      default: settings[key].default,\n      type: settings[key].kind,\n    })\n  }\n}\n","import { chain, assocPath } from \"rambda\"\nimport { getSettings } from \"./settings.js\"\nimport { log } from \"./log.js\"\n\nexport function register() {\n  const settings = getSettings()\n\n  log(settings)\n  if (settings[\"reroll-npc-health\"]) {\n    Hooks.on(\"createToken\", onEvent)\n  }\n}\n\nasync function onEvent(token, _options, userId) {\n  log(token, _options, userId)\n\n  // Only for the owner\n  if (game.userId !== userId) {\n    return\n  }\n\n  // no token\n  if (!token) {\n    return\n  }\n  // actor doesn't exists\n  if (!token.actor) {\n    return\n  }\n  // token is not hostile\n  if (token.disposition > -1) {\n    return\n  }\n\n  // token is a player\n  if (token.actor.hasPlayerOwner) {\n    return\n  }\n\n  const actor = token.actor\n  const formula = getProperty(actor, \"system.attributes.hp.formula\")\n  if (!formula) {\n    return getProperty(actor, \"system.attributes.hp.max\") || 0\n  }\n\n  const roll = new Roll(formula)\n  const hp = await roll.evaluate({ async: true })?.total\n\n  token.update({\n    actorData: {\n      data: {\n        attributes: {\n          hp: {\n            value: hp,\n            max: hp,\n          },\n        },\n      },\n    },\n  })\n\n  await roll.toMessage(\n    {\n      flavor: `${actor.name} rolls for HP!`,\n    },\n    {\n      rollMode: \"gmroll\", // or 'roll'\n      speaker: ChatMessage.getSpeaker({ actor }),\n    },\n  )\n}\n","import * as r from \"rambda\"\n\nimport { moduleName, i18n } from \"./constants.js\"\nimport { registerSettings, getSettings } from \"./settings.js\"\nimport * as rerollHealth from \"./reroll_health.js\"\n\nHooks.once(\"init\", () => {\n  registerSettings()\n})\n\nHooks.once(\"setup\", () => {\n  rerollHealth.register()\n})\n\nHooks.once(\"ready\", () => {\n  const game = window.game\n\n  if (!game.modules.get(\"lib-wrapper\")?.active && game.user.isGM)\n    ui.notifications.error(\n      `Module ${MODULE} requires the 'libWrapper' module. Please install and activate it.`,\n    )\n})\n"],"names":["mod.id","rerollHealth.register"],"mappings":"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","x_google_ignoreList":[0]}